<p-toast></p-toast>
<div class="menu-management-container">
  <div class="header-section">
    <h2 class="page-title">
      <i class="pi pi-book"></i>
      Gestione Catalogo Men√π
    </h2>
    <button pButton pRipple label="Nuova Categoria"
            icon="pi pi-plus-circle"
            class="p-button-rounded p-button-success"
            (click)="onCategoryCreate()">
    </button>
  </div>

  <div class="categories-tabs" *ngIf="(categories$ | async) as categories">
    <p-scrollPanel [style]="{width: '100%', height: '80px'}">
      <div class="tabs-container">
        <button *ngFor="let category of categories"
                class="category-tab"
                [class.active]="selectedCategory?.id === category.id"
                [style.--category-color]="category.color"
                (click)="onCategorySelect(category)">
          <span class="category-name">{{category.name}}</span>
          <span class="category-description">{{category.description}}</span>
        </button>
      </div>
    </p-scrollPanel>
  </div>

  <div class="content-section" *ngIf="selectedCategory">
    <div class="category-header">
      <div class="category-info">
        <div class="category-badge" [style.background-color]="selectedCategory.color">
          <i class="pi pi-tag"></i>
        </div>
        <div class="category-details">
          <h3>{{selectedCategory.name}}</h3>
          <p>{{selectedCategory.description}}</p>
        </div>
      </div>
      <div class="category-actions">
        <button pButton pRipple
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-plain"
                pTooltip="Modifica Categoria"
                tooltipPosition="bottom"
                (click)="editCategory()">
        </button>
        <button pButton pRipple
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-danger"
                pTooltip="Elimina Categoria"
                tooltipPosition="bottom"
                (click)="deleteCategory()">
        </button>
        <button pButton pRipple label="Aggiungi Prodotto"
                icon="pi pi-plus"
                class="p-button-rounded p-button-success"
                (click)="onMenuItemCreate()">
        </button>
      </div>
    </div>

    <menu-item-list
      [items]="(items$ | async)!"
      [categoryName]="selectedCategory?.name!"
      [categoryColor]="selectedCategory?.color!"
      (edit)="onMenuItemEdit($event)"
      (delete)="onMenuItemDelete($event)">
    </menu-item-list>
  </div>

  <div class="empty-state" *ngIf="!selectedCategory">
    <i class="pi pi-inbox"></i>
    <h3>Seleziona una categoria</h3>
    <p>Scegli una categoria dalla barra superiore per visualizzare e gestire i prodotti</p>
  </div>
</div>
<p-dialog header="Creazione Categoria"
          [style]="{height: '80vh'}"
          [(visible)]="categoryDisplay"
          [draggable]="false">
  <form (ngSubmit)="onCategorySubmit()" [formGroup]="categoryForm!">
    <label>Nome</label>
    <input formControlName="name"
           pInputText
           type="text">
    <label>Descrizione</label>
    <input formControlName="description"
           pInputText
           type="text">
    <label>Colore</label>
    <p-colorPicker [inline]="true" formControlName="color"></p-colorPicker>
    <label>Identificativo esterno</label>
    <input formControlName="externalId"
           pInputText
           type="number">
    <div class="confirm-form">
      <button (click)="discardCategoryForm()"
              [label]="i18n.COMMON.UNDO"
              class="p-button-secondary" pButton pRipple
              type="button"></button>
      <button [disabled]="categoryForm?.valid ? !categoryForm?.valid : true"
              [label]="i18n.COMMON.SAVE"
              class="p-button-success" pButton pRipple
              type="submit"></button>
    </div>
  </form>
</p-dialog>
<p-dialog header="Aggiungi Prodotto"
          [style]="{height: '50vh'}"
          [(visible)]="menuItemDisplay"
          [draggable]="false">
  <form (ngSubmit)="onMenuItemSubmit()" [formGroup]="menuItemForm!">
    <label>Nome</label>
    <input formControlName="name"
           pInputText
           type="text">
    <label>Descrizione</label>
    <input formControlName="description"
           pInputText
           type="text">
    <p class="form-category_title">Categoria: <span>{{selectedCategory?.name}}</span></p>
    <label>Identificativo esterno</label>
    <input formControlName="externalId"
           pInputText
           type="number">
    <div class="confirm-form">
      <button (click)="discardMenuItemForm()"
              [label]="i18n.COMMON.UNDO"
              class="p-button-secondary" pButton pRipple
              type="button"></button>
      <button [disabled]="menuItemForm?.valid ? !menuItemForm?.valid : true"
              [label]="i18n.COMMON.SAVE"
              class="p-button-success" pButton pRipple
              type="submit"></button>
    </div>
  </form>
</p-dialog>
<p-confirmDialog header="Conferma eliminazione"
                 icon="pi pi-exclamation-triangle"
                 acceptLabel="Si"
                 rejectLabel="No">
</p-confirmDialog>
